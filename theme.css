/* ===========================
   Dowson Farms — theme.css
   =========================== */
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600&display=swap');

:root {
  /* Brand palette */
  --brand-green: #1B5E20;
  --brand-gold:  #f1d565;
  --brand-gold-dark: #B8860B; /* legacy */
  --paper: #f6f3e4;
  --ink:   #222;

  /* Calm, readable tones */
  --gold-text: #1b1b1b;

  /* Softer gold used elsewhere */
  --accent-gold: #E7CA4A;

  /* Subtle tan band (auth/footer/breadcrumbs) */
  --auth-edge-bg: #E6DCB8;

  /* Breadcrumb foreground */
  --crumb-fg: #666;

  /* Tile hooks (light defaults) */
  --tile-bg: #fff;
  --tile-border: var(--brand-green);

  /* Layout sizing */
  --header-h: 64px;
  --crumb-h:  40px;
  --footer-h: 40px;
  --pad-x:    16px;

  /* Z-index */
  --z-header:  1000;
  --z-crumbs:   900;
  --z-footer:  1000;
}

/* ===========================
   Base
   =========================== */
html, body { height: 100%; }
body {
  margin: 0;
  font-family: 'Montserrat', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  background: var(--paper);
  color: var(--ink);
  padding-top: calc(var(--header-h) + var(--crumb-h));
  padding-bottom: var(--footer-h);
}

/* ===========================
   Sticky Header
   =========================== */
.app-header {
  position: fixed; top: 0; left: 0; right: 0;
  height: var(--header-h);
  background: var(--brand-green);
  color: #fff;
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 var(--pad-x);
  padding-top: env(safe-area-inset-top, 8px);
  padding-bottom: 6px;
  box-sizing: border-box;
  box-shadow: 0 2px 6px rgba(0,0,0,.18);
  z-index: var(--z-header);
}
.app-header__left,
.app-header__right { display: flex; align-items: center; gap: 10px; }

.app-header__title {
  font-family: 'Playfair Display', serif;
  font-weight: 600;
  font-size: 1.25rem;
  letter-spacing: .2px;
}
.app-logo { width: 32px; height: 32px; border-radius: 8px; }
.clock {
  font-variant-numeric: tabular-nums;
  font-weight: 600;
  min-width: 9.5ch;
  text-align: right;
}

/* ===========================
   Breadcrumbs
   =========================== */
.breadcrumbs {
  position: fixed; top: var(--header-h); left: 0; right: 0;
  height: var(--crumb-h);
  display: flex; align-items: center; justify-content: space-between;
  background: var(--auth-edge-bg);
  color: var(--crumb-fg);
  padding: 0 var(--pad-x);
  border-bottom: 1px solid rgba(0,0,0,.12);
  box-shadow: 0 1px 0 rgba(0,0,0,.08);
  z-index: var(--z-crumbs);
  overflow: hidden; /* guardrail for long labels */
}

.breadcrumbs ol {
  display: flex;
  align-items: center;
  gap: 6px;
  list-style: none;
  margin: 0;
  padding: 0;
  font-size: .85rem;
  font-weight: 500;

  flex: 1 1 auto;      /* take remaining space beside Logout */
  min-width: 0;        /* allow children to shrink */
  white-space: nowrap; /* no wrapping */
  overflow: hidden;
}

/* Core of the fix:
   - first and last crumb: keep natural width
   - middle crumbs: share remaining space and ellipsis
   - separators never flex
*/
.breadcrumbs ol li { flex: 0 0 auto; white-space: nowrap; }
.breadcrumbs ol li:not(.sep):not(:first-child):not(:last-child) {
  flex: 0 1 auto;       /* shrinkable, no growth */
  min-width: 0;         /* enables ellipsis when clamped */
}
.breadcrumbs ol li:not(.sep):not(:first-child):not(:last-child) {
  flex: 1 1 0;          /* allow middle crumbs to shrink */
  min-width: 0;         /* required for ellipsis */
}
.breadcrumbs ol li:not(.sep):not(:first-child):not(:last-child) > a,
.breadcrumbs ol li:not(.sep):not(:first-child):not(:last-child) > span {
  display: block;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* Links + hover */
.breadcrumbs a { color: var(--crumb-fg); text-decoration: none; }
.breadcrumbs a:hover { text-decoration: underline; }
.breadcrumbs .sep { color: var(--crumb-fg); opacity: .9; font-size: .85rem; }

/* Logout never shrinks (prevents collision) */
.breadcrumbs .logout-btn {
  background: var(--brand-green);
  color: #fff;
  font-family: 'Playfair Display', serif;
  font-weight: 600;
  font-size: .88rem;
  letter-spacing: .2px;
  line-height: 1.15;
  padding: 4px 12px;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0,0,0,.12);
  flex-shrink: 0;
}
.breadcrumbs .logout-btn:hover,
.breadcrumbs .logout-btn:focus-visible {
  background: #154a18;
  outline: none;
}

@media (hover: none) {
  .breadcrumbs a { padding: 6px 2px; }
}

/* ===========================
   Content Wrapper
   =========================== */
.content {
  padding: 16px;
  /* extra breathing room so fixed buttons never overlap */
  min-height: calc(100vh - var(--header-h) - var(--crumb-h) - var(--footer-h));
  padding-bottom: calc(var(--footer-h) + 80px);
}

/* ===========================
   Footer
   =========================== */
.app-footer {
  position: fixed; left: 0; right: 0; bottom: 0;
  height: var(--footer-h);
  background: var(--auth-edge-bg);
  color: #666;
  display: flex; align-items: center; justify-content: center;
  gap: 8px; padding: 0 var(--pad-x);
  font-weight: 600; font-size: .80rem;
  z-index: var(--z-footer);
}
.app-footer .dot { opacity: .6; color: #666; }

/* ===========================
   Tiles
   =========================== */
.df-tiles {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap: 10px;
  padding: 14px;
}
.df-tile {
  aspect-ratio: 7 / 4;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  background: var(--tile-bg);
  border: 2px solid var(--tile-border);
  border-radius: 12px;
  text-decoration: none; text-align: center;
  color: var(--ink);
  font-weight: 600;
  padding: 8px;
  box-sizing: border-box;
  overflow: hidden;
}
.df-tile:hover { background: var(--brand-gold); color: #000; }
.df-tile span {
  display: block; margin-top: 6px;
  font-size: .86rem; line-height: 1.2; word-break: break-word;
  color: var(--ink);
}

/* ===========================
   Headings
   =========================== */
.content h1 {
  font-family: 'Montserrat', sans-serif;
  font-size: 1.4rem; font-weight: 500; letter-spacing: .3px;
  margin: 0 0 1rem; color: var(--ink);
}
body.home-page .content h1 {
  font-family: 'Playfair Display', serif;
  font-size: 1.35rem;
  font-weight: 600;
  letter-spacing: .2px;
  color: var(--ink);
}

/* ===========================
   Forms (global look)
   =========================== */
.field label{
  display:block; font-weight:700; color: var(--brand-green); margin:0 0 6px;
}
.field-hint{ margin:6px 2px 0; font-size:.9rem; color:#b00020; }

/* Controls follow tile colors (light & dark) */
.field input[type="text"],
.field input[type="email"],
.field input[type="password"],
.field input[type="date"],
.field select,
.field textarea {
  width: 100%;
  padding: 11px 12px;
  border: 2px solid var(--tile-border);
  border-radius: 12px;
  background: var(--tile-bg);
  color: var(--ink);
  font-size: 16px; /* no iOS zoom */
  box-sizing: border-box;
  outline: none;
}
.field input::placeholder,
.field textarea::placeholder { color: rgba(127,127,127,.9); }

/* Theme-aware, accessible focus ring */
:root { --df-focus-ring: rgba(27,94,32,.55); } /* green for light */
@media (prefers-color-scheme: dark) {
  :root[data-theme="auto"] { --df-focus-ring: rgba(218,165,32,.55); } /* gold for dark auto */
}
:root[data-theme="dark"] { --df-focus-ring: rgba(218,165,32,.55); }    /* gold for dark forced */

.field input:focus-visible,
.field select:focus-visible,
.field textarea:focus-visible,
button:focus-visible {
  outline: none;
  box-shadow: 0 0 0 3px var(--df-focus-ring);
  border-color: var(--tile-border);
}

/* --- iOS/Safari normalization so DATE matches SELECT width --- */
.field select,
.field input[type="date"] {
  -webkit-appearance: none;
  appearance: none;
}
.field input[type="date"] {
  padding-right: 12px;                    /* match select’s right inset */
}
.field input[type="date"]::-webkit-calendar-picker-indicator {
  margin: 0; padding: 0;                  /* avoid hidden extra space on the right */
}
.field input[type="date"]::-webkit-datetime-edit {
  padding: 0;                             /* prevent internal padding differences */
}

/* Keep fields in a row sharing space evenly, and allow shrink on small screens */
.row { display:flex; gap:12px; flex-wrap:wrap; }
.row > .field { flex: 1 1 0; min-width: 0; }  /* true 50/50 and no overflow */

/* Form actions: center primary, keep gaps, safe from Back button */
.form-actions {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  align-items: center;
  gap: 12px;
  margin: 18px 0;
  padding-bottom: calc(var(--footer-h) + 28px);
}
.form-actions > .btn-primary {
  grid-column: 2;
  justify-self: center;
}
.form-actions > .btn-secondary,
.form-actions > .btn-outline {
  justify-self: end;
}

/* Buttons, matching Back button look */
.btn-primary {
  background: var(--brand-green);
  color: #fff;
  border: 2px solid var(--brand-green);
  border-radius: 12px;
  padding: 10px 18px;
  font: 600 1rem 'Playfair Display', serif;
  cursor: pointer;
  box-shadow: 0 6px 16px rgba(0,0,0,.12);
}
.btn-primary:hover { background:#154a18; }

.btn-secondary, .btn-outline {
  background: #fff;
  color: var(--brand-green);
  border: 2px solid var(--brand-green);
  border-radius: 12px;
  padding: 8px 14px;
  font: 600 .95rem 'Playfair Display', serif;
  cursor: pointer;
  box-shadow: 0 6px 16px rgba(0,0,0,.12);
}
:root[data-theme="dark"] .btn-secondary,
:root[data-theme="auto"] .btn-secondary,
:root[data-theme="dark"] .btn-outline,
:root[data-theme="auto"] .btn-outline {
  background: var(--tile-bg);
}

/* Quick View floating button (bottom-right) */
.quick-view-fab{
  position: fixed;
  right: 10px;
  bottom: calc(env(safe-area-inset-bottom, 0px) + var(--footer-h) + 8px);
  display: inline-flex; align-items: center; gap: 6px;
  padding: 6px 12px;
  background: #fff;
  color: var(--brand-green);
  border: 2px solid var(--brand-green);
  border-radius: 12px;
  font: 600 .95rem 'Playfair Display', serif;
  box-shadow: 0 6px 16px rgba(0,0,0,.12);
  cursor: pointer;
  z-index: calc(var(--z-footer) + 12);
}
:root[data-theme="dark"] .quick-view-fab,
:root[data-theme="auto"] .quick-view-fab { background: var(--tile-bg); }

/* ===========================
   Back button (bottom-left)
   =========================== */
.back-fab{
  position: fixed;
  left: 10px;
  bottom: calc(env(safe-area-inset-bottom, 0px) + var(--footer-h) + 8px);
  display: inline-flex; align-items: center; gap: 6px;
  padding: 6px 10px;
  background: #fff;
  color: var(--brand-green);           /* LIGHT DEFAULT (and AUTO when system is light) */
  border: 2px solid var(--brand-green);
  border-radius: 12px;
  font: 600 .9rem 'Playfair Display', serif;
  box-shadow: 0 6px 16px rgba(0,0,0,.12);
  cursor: pointer;
  z-index: calc(var(--z-footer) + 10);
}
:root[data-theme="dark"] .back-fab,
:root[data-theme="auto"] .back-fab { background: var(--tile-bg); }
.back-fab .chev{ font-size: 1.1rem; line-height: 1; transform: translateY(-1px); }
.back-fab:hover, .back-fab:focus-visible{ background:#fefefe; outline: none; }

/* Back button: WHITE TEXT in true dark, and in AUTO only when system is dark */
:root[data-theme="dark"] .back-fab { color: #fff; }
@media (prefers-color-scheme: dark) {
  :root[data-theme="auto"] .back-fab { color: #fff; }
}

/* Small phones */
@media (max-width: 360px){
  .auth-hero__title{ font-size: 1.2rem; }
  .auth-card{ width: 90vw; }
}

/* ===========================
   AUTH (Login / Forgot)
   =========================== */
.auth-page { --footer-h: 36px; }
.auth-page{
  background: linear-gradient(180deg, #f6f3e4 0%, #efe9cf 100%);
  background-color: #efe9cf;
  background-attachment: fixed;
  padding-top: calc(env(safe-area-inset-top, 0px) + 6px);
  padding-bottom: calc(env(safe-area-inset-bottom, 0px) + var(--footer-h));
}
.auth-page::before{
  content:""; position: fixed; top:0; left:0; right:0;
  height: env(safe-area-inset-top, 0px); background: var(--auth-edge-bg);
  pointer-events:none; z-index:0;
}
.auth-page::after{
  content:""; position: fixed; left:0; right:0; bottom:0;
  height: env(safe-area-inset-bottom, 0px); background: var(--auth-edge-bg);
  pointer-events:none; z-index:0;
}
.auth-wrap { min-height: calc(100vh - var(--footer-h)); display:flex; flex-direction:column; align-items:center; justify-content:center; gap:8px; }

/* Hero */
.auth-hero{ text-align:center; padding:2px 12px 0; transform:translateY(-40px); margin-bottom:-20px; }
.auth-hero__logo{ width:70px; height:70px; margin:0 auto 6px; border-radius:50%; background:#fff; border:2px solid var(--brand-green); display:grid; place-items:center; box-shadow:0 3px 8px rgba(0,0,0,.08); }
.auth-hero__logo img{ width:52px; height:52px; border-radius:8px; object-fit:contain; }
.auth-hero__title{ font-family:'Playfair Display', serif; font-size:1.28rem; font-weight:600; letter-spacing:.2px; margin:0 0 4px; color: var(--brand-green); }
.auth-hero__subtitle{ font-size:.95rem; color:#5b5b5b; margin:0 0 6px; }

/* Card */
.auth-card {
  width: min(330px, 88vw);
  margin: 0 auto;
  padding: 20px 16px 28px;
  background: #fff;
  border: 2px solid var(--brand-green);
  border-radius: 14px;
  box-shadow: 0 8px 22px rgba(0,0,0,.10);
}

/* Login inputs (use global .field control styles) */
.password-wrap{ position:relative; }
.password-wrap .eye{
  position:absolute; right:10px; top:50%; transform:translateY(-50%);
  display:inline-grid; place-items:center;
  width:28px; height:28px; border:0; background:transparent; cursor:pointer; color:var(--brand-green);
}
.password-wrap .eye svg{ width:20px; height:20px; display:block; }

.form-row{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin:2px 0 6px; }
.checkbox{ display:inline-flex; align-items:center; gap:8px; cursor:pointer; }
.checkbox input{ width:18px; height:18px; }

.muted-link{ color:#3a3a3a; text-decoration:none; font-weight:600; font-size:.88rem; }
.muted-link:hover{ text-decoration: underline; }

.auth-page .btn-primary {
  width: 100%;
  padding: 9px 12px;
  border: 0;
  border-radius: 12px;
  background: var(--brand-green);
  color: #fff;
  font-family: 'Playfair Display', serif;
  font-weight: 600;
  font-size: .95rem;
  cursor: pointer;
  box-shadow: 0 6px 18px rgba(0,0,0,.12);
  margin-top: 16px;
}
.auth-page .btn-primary:hover { background:#154a18; }

.app-footer--auth{
  position: fixed; left: 0; right: 0; bottom: 0;
  height: var(--footer-h);
  background: var(--auth-edge-bg);
  color: #666;
  display: flex; align-items: center; justify-content: center;
  font-size: .85rem; padding: 0 10px;
  border-top: 1px solid rgba(0,0,0,.06);
  z-index: 1000;
}
.app-footer--auth .dot{ opacity:.6; }

.auth-modal__backdrop{
  position: fixed; inset: 0; display: none;
  align-items: center; justify-content: center;
  background: rgba(0,0,0,.38);
  z-index: 2000;
}
.auth-modal{
  width: min(420px, 92vw);
  background: #fff;
  border: 2px solid var(--brand-green);
  border-radius: 14px;
  box-shadow: 0 18px 40px rgba(0,0,0,.25);
  padding: 16px;
}
.auth-modal h2{ margin: 0 0 8px; font-size: 1.1rem; color: var(--brand-green); }
.auth-modal .modal-actions{ display:flex; justify-content:flex-end; gap:8px; margin-top:12px; }
.btn-link{ background:transparent; border:none; color:var(--brand-green); font-weight:700; cursor:pointer; padding:6px 10px; }

/* ===========================
   Dark / Auto Theme overrides
   =========================== */
@media (prefers-color-scheme: dark) {
  :root[data-theme="auto"] {
    --paper: #141612;
    --ink:   #e8e6df;
    --brand-green: #184a1b;
    --auth-edge-bg: #2a2d24;
    --accent-gold: #d9c767;
    --gold-text: #e9e5cc;
    --jd-yellow-dark: #bfa100;
    --tile-bg: #1c1f18;
    --tile-border: #2d6a31;
    --crumb-fg: #cfcfcf;
  }
}
:root[data-theme="dark"] {
  --paper: #141612;
  --ink:   #e8e6df;
  --brand-green: #184a1b;
  --auth-edge-bg: #2a2d24;
  --accent-gold: #d9c767;
  --gold-text: #e9e5cc;
  --jd-yellow-dark: #bfa100;
  --tile-bg: #1c1f18;
  --tile-border: #2d6a31;
  --crumb-fg: #cfcfcf;
}
:root[data-theme="light"] { /* defaults */ }

/* Auth background in dark/auto (to match app) */
@media (prefers-color-scheme: dark) {
  :root[data-theme="auto"] .auth-page {
    background: linear-gradient(180deg, #1a1c17 0%, #12140f 100%);
    background-color: #12140f;
  }
}
:root[data-theme="dark"] .auth-page {
  background: linear-gradient(180deg, #1a1c17 0%, #12140f 100%);
  background-color: #12140f;
}

/* Auth controls match tiles in dark/auto */
@media (prefers-color-scheme: dark) {
  :root[data-theme="auto"] .auth-card,
  :root[data-theme="auto"] .auth-modal,
  :root[data-theme="auto"] .auth-card input[type="text"],
  :root[data-theme="auto"] .auth-card input[type="email"],
  :root[data-theme="auto"] .auth-card input[type="password"],
  :root[data-theme="auto"] .auth-modal input[type="text"],
  :root[data-theme="auto"] .auth-modal input[type="email"],
  :root[data-theme="auto"] .auth-modal input[type="password"]{
    background: var(--tile-bg);
    border-color: var(--tile-border);
    color: var(--ink);
  }
  :root[data-theme="auto"] .auth-card,
  :root[data-theme="auto"] .auth-modal{
    border-width: 2px; border-style: solid; border-radius: 14px;
    box-shadow: 0 8px 22px rgba(0,0,0,.25);
  }
  :root[data-theme="auto"] .auth-card .field label,
  :root[data-theme="auto"] .auth-modal .field label{ color: var(--ink); }
  :root[data-theme="auto"] .auth-card ::placeholder,
  :root[data-theme="auto"] .auth-modal ::placeholder{ color: rgba(232,230,223,.65); }
  :root[data-theme="auto"] .auth-card .field input:focus,
  :root[data-theme="auto"] .auth-modal .field input:focus{
    border-color: var(--tile-border); box-shadow: 0 0 0 3px rgba(45,106,49,.30); outline: none;
  }
}
:root[data-theme="dark"] .auth-card,
:root[data-theme="dark"] .auth-modal,
:root[data-theme="dark"] .auth-card input[type="text"],
:root[data-theme="dark"] .auth-card input[type="email"],
:root[data-theme="dark"] .auth-card input[type="password"],
:root[data-theme="dark"] .auth-modal input[type="text"],
:root[data-theme="dark"] .auth-modal input[type="email"],
:root[data-theme="dark"] .auth-modal input[type="password"]{
  background: var(--tile-bg);
  border-color: var(--tile-border);
  color: var(--ink);
}
:root[data-theme="dark"] .auth-card,
:root[data-theme="dark"] .auth-modal{
  border-width: 2px; border-style: solid; border-radius: 14px;
  box-shadow: 0 8px 22px rgba(0,0,0,.25);
}
:root[data-theme="dark"] .auth-card .field label,
:root[data-theme="dark"] .auth-modal .field label{ color: var(--ink); }
:root[data-theme="dark"] .auth-card ::placeholder,
:root[data-theme="dark"] .auth-modal ::placeholder{ color: rgba(232,230,223,.65); }
:root[data-theme="dark"] .auth-card .field input:focus,
:root[data-theme="dark"] .auth-modal .field input:focus{
  border-color: var(--tile-border); box-shadow: 0 0 0 3px rgba(45,106,49,.30); outline: none;
}
/* Add a conditional gap only if a crumb is directly before Logout */
.breadcrumbs ol + .logout-btn {
  margin-left: 10px;
}

/* ===========================
   Teams & Partners hub tiles
   =========================== */

:root {
  /* fallbacks if not already defined */
  --tile-bg: var(--tile-bg, #fff);
  --tile-border: var(--tile-border, var(--brand-green, #1B5E20));
  --ink: var(--ink, #222);
}

.hub-grid {
  list-style: none;
  padding: 0; margin: 12px 0 0 0;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 12px;
}

.hub-card {
  display: block;
  text-decoration: none;
  background: var(--tile-bg);
  color: var(--ink);
  border: 1px solid var(--tile-border);
  border-radius: 12px;
  padding: 14px;
  transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
}

.hub-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 18px rgba(0,0,0,0.08);
}

.hub-card__title {
  font-weight: 700;
  margin: 0 0 4px 0;
}

.hub-card__sub {
  opacity: .75;
  font-size: .92rem;
}

/* Dark mode */
[data-theme="dark"] .hub-card {
  background: #121417;
  color: #e8e8e8;
  border-color: rgba(255,255,255,0.12);
}

/* =========================================
   GLOBAL Menu Tiles (unified across pages)
   Use any of these grid classes:
   .menu-grid, .hub-grid, .reports-grid, .tools-grid
   Use any of these card classes:
   .menu-card, .hub-card, .report-card, .tool-card
   ========================================= */

:root {
  --tile-bg: var(--tile-bg, #fff);
  --tile-border: var(--tile-border, var(--brand-green, #1B5E20));
  --tile-radius: 12px;
  --tile-pad: 14px;
  --ink: var(--ink, #222);
}

/* Grids (aliases) */
.menu-grid,
.hub-grid,
.reports-grid,
.tools-grid {
  list-style: none;
  padding: 0;
  margin: 12px 0 0 0;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 12px;
}

/* Cards (aliases) */
.menu-card,
.hub-card,
.report-card,
.tool-card {
  display: block;
  text-decoration: none;
  background: var(--tile-bg);
  color: var(--ink);
  border: 1px solid var(--tile-border);
  border-radius: var(--tile-radius);
  padding: var(--tile-pad);
  transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
}

.menu-card:hover,
.hub-card:hover,
.report-card:hover,
.tool-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 18px rgba(0,0,0,0.08);
}

/* Common interior */
.menu-card__title,
.hub-card__title,
.report-card__title,
.tool-card__title {
  font-weight: 700;
  margin: 0 0 4px 0;
}

.menu-card__sub,
.hub-card__sub,
.report-card__sub,
.tool-card__sub {
  opacity: .75;
  font-size: .92rem;
}

/* Optional icon slot */
.menu-card__icon,
.hub-card__icon,
.report-card__icon,
.tool-card__icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 36px; height: 36px;
  border-radius: 50%;
  border: 1px solid var(--tile-border);
  margin-bottom: 8px;
}

/* Dark mode */
[data-theme="dark"] .menu-card,
[data-theme="dark"] .hub-card,
[data-theme="dark"] .report-card,
[data-theme="dark"] .tool-card {
  background: #121417;
  color: #e8e8e8;
  border-color: rgba(255,255,255,0.12);
}

/* Breadcrumbs: CSS-only safety so middle crumbs flex and never leave a gap */
.breadcrumbs ol { display:flex; align-items:center; gap:6px; }
.breadcrumbs ol li { margin:0; flex:0 0 auto; white-space:nowrap; }
.breadcrumbs ol li.sep { flex:0 0 auto; }

.breadcrumbs ol li:not(.sep):not(:first-child):not(:last-child) {
  flex: 1 1 0;
  min-width: 0;
}
.breadcrumbs ol li:not(.sep):not(:first-child):not(:last-child) > a,
.breadcrumbs ol li:not(.sep):not(:first-child):not(:last-child) > span {
  display:block;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}

/* Cap the LAST crumb so it never crowds Logout, but only as needed */
.breadcrumbs ol li:last-child { flex: 0 1 55%; min-width: 0; }
.breadcrumbs ol li:last-child > a,
.breadcrumbs ol li:last-child > span {
  display:block;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}

/* If some old script injected fixed widths, neutralize them when not needed */
.breadcrumbs ol a,
.breadcrumbs ol span {
  max-width: initial;           /* resets stale inline max-width */
}

/* === Breadcrumb overflow fix === */
.breadcrumbs {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.breadcrumbs ol {
  display: flex;
  align-items: center;
  flex: 1 1 auto;
  min-width: 0;            /* critical: allows shrinking */
  overflow: hidden;        /* keeps text inside */
}

.breadcrumbs ol li {
  flex: 0 0 auto;
  white-space: nowrap;
}

.breadcrumbs ol li:not(.sep):not(:first-child):not(:last-child) {
  flex: 1 1 auto;          /* middle crumbs shrink */
  min-width: 0;            /* required for ellipsis */
}

.breadcrumbs ol li:not(.sep):not(:first-child):not(:last-child) > a,
.breadcrumbs ol li:not(.sep):not(:first-child):not(:last-child) > span {
  display: block;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.ai-powered-note {
  text-align: center;
  font-style: italic;
  margin-top: 20px;
  opacity: 0.75;
  font-size: 0.92rem;
}

/* Tile grid container */
.df-tiles {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 16px;
  margin-top: 20px;
}

/* Individual tile */
.df-tile {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
  border: 2px solid var(--tile-border, #1B5E20); /* fallback green */
  border-radius: 12px;
  text-align: center;
  background: var(--tile-bg, #fff);
  color: var(--ink, #222);
  font-weight: 600;
  text-decoration: none;
  transition: background 0.2s, transform 0.1s;
}

/* Emoji + label spacing */
.df-tile span {
  margin-top: 8px;
  display: block;
}

/* Hover / active feedback */
.df-tile:hover {
  background: #f1f1f1;
  transform: translateY(-2px);
}
.df-tile:active {
  transform: translateY(0);
}

/* Color-scheme bridge so user agent controls match the resolved theme
   while allowing [data-theme="auto"] CSS to keep working */
:root[data-theme="light"] { color-scheme: light; }
:root[data-theme="dark"]  { color-scheme: dark;  }
:root[data-theme="auto"]  { color-scheme: light; } /* default */

@media (prefers-color-scheme: dark) {
  :root[data-theme="auto"] { color-scheme: dark; }
}

/* =======================================================================
   === PATCH A: Auto really follows device for tiles & Theme switches ===
   - Keeps tiles/switch rows light when device is light
   - Matches dark styling when device is dark
   - Only applies while data-theme="auto"
   ======================================================================= */
@media (prefers-color-scheme: light) {
  :root[data-theme="auto"] .df-tile,
  :root[data-theme="auto"] .menu-card,
  :root[data-theme="auto"] .hub-card,
  :root[data-theme="auto"] .report-card,
  :root[data-theme="auto"] .tool-card,
  :root[data-theme="auto"] .switch {
    background: var(--tile-bg);   /* white */
    color: var(--ink);
    border-color: var(--tile-border);
  }
}
@media (prefers-color-scheme: dark) {
  :root[data-theme="auto"] .df-tile,
  :root[data-theme="auto"] .menu-card,
  :root[data-theme="auto"] .hub-card,
  :root[data-theme="auto"] .report-card,
  :root[data-theme="auto"] .tool-card,
  :root[data-theme="auto"] .switch {
    background: var(--tile-bg);   /* #1c1f18 via tokens */
    color: var(--ink);
    border-color: var(--tile-border);
  }
}

/* Theme page “switch” row styles (safe if not present elsewhere) */
.switch {
  display: flex; align-items: center; gap: 12px;
  padding: 10px 12px;
  border: 2px solid var(--brand-green);
  border-radius: 12px;
  background: var(--tile-bg);
}
.switch input[type="radio"] { position: absolute; opacity: 0; pointer-events: none; }
.switch-track {
  width: 48px; height: 28px; border-radius: 999px;
  background: #e5e5e5;
  display: inline-flex; align-items: center;
  padding: 3px; box-sizing: border-box;
  transition: background .2s ease, box-shadow .2s ease, border-color .2s ease;
  border: 1px solid rgba(0,0,0,.12);
}
.switch .knob {
  width: 22px; height: 22px; border-radius: 50%;
  background: #fff; box-shadow: 0 1px 2px rgba(0,0,0,.25);
  transform: translateX(0); transition: transform .2s ease;
}
.switch input:checked + .switch-track {
  background: var(--brand-green); border-color: var(--brand-green);
}
.switch input:checked + .switch-track .knob { transform: translateX(20px); }
.switch-label { font-weight: 700; color: var(--brand-green); }
.switch-desc  { margin-left: auto; font-size: .9rem; color: #666; }

/* =======================================================================
   === PATCH B: Visible focus ring (Light & Dark) + iOS control tint fix ===
   - Makes the “box indicator” obvious in Light mode
   - Uses gold-ish ring in Dark (via tokens you already set)
   ======================================================================= */
:root { --df-focus-ring: rgba(27, 94, 32, .55); } /* Light */
@media (prefers-color-scheme: dark) {
  :root[data-theme="auto"] { --df-focus-ring: rgba(218,165,32,.55); }
}
:root[data-theme="dark"] { --df-focus-ring: rgba(218,165,32,.55); }

input, select, textarea, button {
  -webkit-appearance: none; /* iOS: stop auto-tinting in Light */
  outline: none;
  border-radius: 10px;
}

input:focus-visible,
select:focus-visible,
textarea:focus-visible,
button:focus-visible {
  box-shadow: 0 0 0 3px var(--df-focus-ring);
}

/* =========================================
   Forms render as cards (non-auth pages)
   ========================================= */
:not(.auth-page) .content form {
  background: var(--tile-bg);
  border: 2px solid var(--tile-border);
  border-radius: 14px;
  padding: 14px;
  box-shadow: 0 6px 16px rgba(0,0,0,.08);

}

/* =========================================
   Forms render as cards (non-auth pages)
   ========================================= */

/* Base (Light) */
:root {
  --tile-bg: #FFFFFF;                 /* card background in light */
  --tile-border: rgba(0, 0, 0, 0.15); /* visible border in light */
}

/* Dark (always dark toggle) */
[data-theme="dark"] {
  --tile-bg: #1e1f1c;
  --tile-border: rgba(255, 255, 255, 0.14);
}

/* Auto = follow device */
[data-theme="auto"] {
  /* light default for auto; overridden by media queries below */
  --tile-bg: #FFFFFF;
  --tile-border: rgba(0, 0, 0, 0.15);
}

@media (prefers-color-scheme: dark) {
  [data-theme="auto"] {
    --tile-bg: #1e1f1c;
    --tile-border: rgba(255, 255, 255, 0.14);
  }
}

/* Apply to all non-auth forms (e.g., Feedback / Issues) */
:not(.auth-page) .content form {
  background: var(--tile-bg);
  border: 2px solid var(--tile-border, rgba(0,0,0,.15));
  border-radius: 14px;
  padding: 14px;
  box-shadow: 0 6px 16px rgba(0,0,0,.08);
}

/* AI Reports polish */
.ai-layout { display: grid; grid-template-columns: 280px 1fr; height: 100%; }
.ai-sidebar { border-right: 1px solid var(--tile-border); padding: 10px; overflow: auto; background: var(--surface-2); }
.ai-main { display: grid; grid-template-rows: 1fr auto; }
.ai-stream { padding: 12px; overflow: auto; }
.msg { margin: 8px 0; padding: 10px 12px; border-radius: 12px; max-width: 800px; border:1px solid var(--tile-border); }
.msg.user { background: var(--tile-bg); }
.msg.assistant { background: #fffef8; }
:root[data-theme="dark"] .msg.assistant { background: rgba(255,255,255,.05); }
.ai-inputbar { display:flex; gap: 8px; padding: 10px; border-top:1px solid var(--tile-border); background: var(--surface-1); }
#ai-input { flex:1; resize:none; padding:10px 12px; border-radius:10px; border:1px solid var(--tile-border); background: var(--tile-bg); }
.btn.primary { background:#1B5E20; color:#fff; border:none; }

/* ===== Breadcrumbs: single line with middle ellipsis (global, safe override) ===== */
:root{
  --crumb-first-ch: 12ch;  /* width hint for first crumb (e.g., "Home") */
  --crumb-middle-ch: 4ch;  /* 3–5ch -> “…”, “Set…”, “Pro…” */
}

/* Keep Logout safe at the right; you already set this, reinforcing */
.breadcrumbs { justify-content: space-between; }

/* Ensure the trail can shrink but never wrap */
.breadcrumbs ol{
  display:flex; align-items:center; gap:6px;
  white-space:nowrap; overflow:hidden; flex:1 1 auto; min-width:0;
}

/* Base li behavior */
.breadcrumbs ol li{ flex:0 0 auto; min-width:0; white-space:nowrap; }
.breadcrumbs ol li.sep{ flex:0 0 auto; }

/* Labels can ellipsize */
.breadcrumbs ol a,
.breadcrumbs ol span{ display:block; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }

/* First crumb gets a little extra room */
.breadcrumbs ol li:not(.sep):first-child a,
.breadcrumbs ol li:not(.sep):first-child span{
  max-width: var(--crumb-first-ch);
}

/* ⭐ All middle crumbs (not first/last) get a small max width -> forces “…” */
.breadcrumbs ol li:not(.sep):not(:first-child):not(:last-child){
  flex:0 1 auto; min-width:0;
}
.breadcrumbs ol li:not(.sep):not(:first-child):not(:last-child) a,
.breadcrumbs ol li:not(.sep):not(:first-child):not(:last-child) span{
  max-width: var(--crumb-middle-ch);
}

/* Last crumb (current page) takes remaining space, ellipsizes only if truly needed */
.breadcrumbs ol li:not(.sep):last-child{ flex:1 1 auto; min-width:0; }
.breadcrumbs ol li:not(.sep):last-child a,
.breadcrumbs ol li:not(.sep):last-child span{ max-width:100%; }


/* =========================================================
   Breadcrumb polish: tighter middles + capped last label
   ========================================================= */
:root{
  /* Tune these two to taste */
  --crumb-middle-ch: 4ch;   /* 3–5ch → “…”, “Pro…”, “Chem…” */
  --crumb-last-max: 52%;    /* last crumb will never exceed this share of the trail */
}

/* Middle crumbs (anything that's not first/last/sep) */
.breadcrumbs ol li:not(.sep):not(:first-child):not(:last-child){
  flex: 0 1 auto;           /* can shrink */
  min-width: 0;
}
.breadcrumbs ol li:not(.sep):not(:first-child):not(:last-child) a,
.breadcrumbs ol li:not(.sep):not(:first-child):not(:last-child) span{
  max-width: var(--crumb-middle-ch); /* << shorter: forces “Pro…”, “Chem…”, etc. */
  overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
}

/* Last crumb (current page): cap its width so it can't crash into Logout */
.breadcrumbs ol li:not(.sep):last-child{
  flex: 0 1 var(--crumb-last-max);   /* hard cap */
  min-width: 0;
}
.breadcrumbs ol li:not(.sep):last-child a,
.breadcrumbs ol li:not(.sep):last-child span{
  max-width: 100%;
  overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
}

/* Keep a little breathing room before Logout (if not already present) */
.breadcrumbs ol + .logout-btn{ margin-left: 10px; }

/* ===== BREADCRUMB HOTFIX (append-only, safe) ===== */
.breadcrumbs{ justify-content: space-between !important; }

.breadcrumbs ol{
  flex: 1 1 auto !important;
  min-width: 0 !important;
  overflow: hidden !important;
  white-space: nowrap !important;
  gap: 6px !important;
}

/* Make sure text can actually ellipsize */
.breadcrumbs ol a,
.breadcrumbs ol span{
  display: block !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
  white-space: nowrap !important;
}

/* Middle crumbs collapse to short labels (“Pro…”, “Chem…”, “Seed…”) */
.breadcrumbs ol li:not(.sep):not(:first-child):not(:last-child){
  flex: 0 1 auto !important;
  min-width: 0 !important;
}
.breadcrumbs ol li:not(.sep):not(:first-child):not(:last-child) > a,
.breadcrumbs ol li:not(.sep):not(:first-child):not(:last-child) > span{
  max-width: 4ch !important; /* adjust 3–6ch to taste */
}

/* Last crumb capped so it never runs into Logout */
.breadcrumbs ol li:not(.sep):last-child{
  flex: 0 1 52% !important;  /* adjust 48–55% to taste */
  min-width: 0 !important;
}
.breadcrumbs ol li:not(.sep):last-child > a,
.breadcrumbs ol li:not(.sep):last-child > span{
  max-width: 100% !important;
}

/* Separators and Logout are never flexible */
.breadcrumbs ol li.sep{ flex: 0 0 auto !important; }
.breadcrumbs .logout-btn{
  flex-shrink: 0 !important;
  margin-left: 10px !important; /* guardrail so last label never kisses it */
}

/* Normalize iOS dark-mode styling for telephone inputs */
input[type="tel"],
input[type="tel"]:focus {
  background: var(--tile-bg) !important;   /* matches your inputs */
  color: var(--text, inherit) !important;
  caret-color: var(--text, inherit);
}

/* Kill iOS autofill tint (shows up black/yellow in dark mode) */
input:-webkit-autofill,
input:-webkit-autofill:hover,
input:-webkit-autofill:focus {
  -webkit-box-shadow: 0 0 0 1000px var(--tile-bg) inset !important;
  -webkit-text-fill-color: var(--text, inherit) !important;
  transition: background-color 9999s ease-out 0s; /* prevents flash */
}

/* Hide the contacts autofill button bubble that can darken the field */
input[type="tel"]::-webkit-contacts-auto-fill-button { display: none; }


/* =========================
   Modal stacking fixes
   ========================= */
.auth-modal__backdrop {
  position: fixed;
  inset: 0;
  display: none;  /* stays hidden until JS toggles it */
  align-items: center;
  justify-content: center;
  z-index: 1000;  /* base modal layer */
}

/* Manage modal sits above base */
#manageBackdrop {
  z-index: 1001;
}

/* Permission Overrides should always be on top */
#exBackdrop {
  z-index: 1002;
}

/* Fix phone input border in dark mode */
[data-theme="dark"] input[type="tel"] {
  border: 2px solid var(--brand-green) !important;
  background: #111; /* match other dark inputs */
  color: #fff;
}

/* Ensure consistency for all input types */
[data-theme="dark"] input[type="text"],
[data-theme="dark"] input[type="email"],
[data-theme="dark"] input[type="password"],
[data-theme="dark"] select {
  border: 2px solid var(--brand-green);
  background: #111;
  color: #fff;
}

/* Prevent duplicate Back buttons in overrides modal */
.permission-overrides .footer .back-button {
  display: none; /* hide the extra one */
}

/* In dark mode, make form labels white instead of green */
[data-theme="dark"] label,
[data-theme="dark"] .form-label,
[data-theme="dark"] .content form strong {
  color: #fff !important;
}

/* Dark mode overrides */
:root[data-theme="dark"] {
  /* Form text */
  label, .form-label, form strong {
    color: #fff !important;
  }

  /* Button text */
  .btn-primary,
  .btn-secondary,
  .btn-outline {
    color: #fff !important;
  }
}

/* ===== FIX 1: Dark mode -> make form labels + all buttons white ===== */
@media (prefers-color-scheme: dark) {
  :root[data-theme="auto"] .field label,
  :root[data-theme="auto"] .form-label,
  :root[data-theme="auto"] .content form strong { color: #fff !important; }

  :root[data-theme="auto"] .btn-primary,
  :root[data-theme="auto"] .btn-secondary,
  :root[data-theme="auto"] .btn-outline { color: #fff !important; }
}
:root[data-theme="dark"] .field label,
:root[data-theme="dark"] .form-label,
:root[data-theme="dark"] .content form strong { color: #fff !important; }
:root[data-theme="dark"] .btn-primary,
:root[data-theme="dark"] .btn-secondary,
:root[data-theme="dark"] .btn-outline { color: #fff !important; }

/* ===== FIX 2: Force GREEN borders on inputs in dark mode (incl. iOS tel) ===== */
@media (prefers-color-scheme: dark) {
  :root[data-theme="auto"] .field input,
  :root[data-theme="auto"] .field select,
  :root[data-theme="auto"] .field textarea {
    border: 2px solid var(--brand-green) !important;
  }
  :root[data-theme="auto"] input[type="tel"] {
    border: 2px solid var(--brand-green) !important;
    background: var(--tile-bg) !important;
    color: var(--ink) !important;
  }
}
:root[data-theme="dark"] .field input,
:root[data-theme="dark"] .field select,
:root[data-theme="dark"] .field textarea {
  border: 2px solid var(--brand-green) !important;
}
:root[data-theme="dark"] input[type="tel"] {
  border: 2px solid var(--brand-green) !important;
  background: var(--tile-bg) !important;
  color: var(--ink) !important;
}

/* ===== FIX 3: Hide fixed Back FAB while any modal is open ===== */
.modal-open .back-fab { display: none !important; }

/* --- Toast (bottom message) --- */
.df-toast {
  position: fixed;
  left: 50%;
  bottom: calc(env(safe-area-inset-bottom, 0px) + 56px);
  transform: translateX(-50%);
  background: var(--brand-green);
  color: #fff;
  border-radius: 12px;
  padding: 10px 14px;
  font-weight: 700;
  box-shadow: 0 8px 22px rgba(0,0,0,.25);
  z-index: 3000;
  opacity: 0;
  transition: opacity .18s ease, transform .18s ease;
}
.df-toast.show {
  opacity: 1;
  transform: translateX(-50%) translateY(-4px);
}

/* ===== Fix: Pill buttons use white text in dark mode (all pages) ===== */
/* Covers Account Roles page and Permission Overrides modal  */
:root[data-theme="dark"] :where(.pill),
@media (prefers-color-scheme: dark) {
  :root[data-theme="auto"] :where(.pill) {
    color: #fff !important;                 /* force white label */
    background: var(--tile-bg) !important;  /* match card bg */
    border-color: var(--tile-border) !important;
  }
}

/* Pressed/active state stays solid green with white text */
:root[data-theme="dark"] :where(.pill[aria-pressed="true"]),
@media (prefers-color-scheme: dark) {
  :root[data-theme="auto"] :where(.pill[aria-pressed="true"]) {
    background: var(--brand-green) !important;
    border-color: var(--brand-green) !important;
    color: #fff !important;
  }
}

/* Disabled pills remain dim but readable in dark mode */
:root[data-theme="dark"] :where(.pill[disabled]),
@media (prefers-color-scheme: dark) {
  :root[data-theme="auto"] :where(.pill[disabled]) {
    opacity: .6 !important;
    color: #ddd !important;
  }
}

/* ========= DARK-MODE FIXES (append to end of theme.css) ========= */

/* 1) Pill buttons: white text in dark & auto(dark) */
:root[data-theme="dark"] .pill {
  color: #fff !important;
  background: var(--tile-bg) !important;
  border-color: var(--tile-border) !important;
}
@media (prefers-color-scheme: dark) {
  :root[data-theme="auto"] .pill {
    color: #fff !important;
    background: var(--tile-bg) !important;
    border-color: var(--tile-border) !important;
  }
}

/* Pressed (active) pills stay green with white text */
:root[data-theme="dark"] .pill[aria-pressed="true"] {
  background: var(--brand-green) !important;
  border-color: var(--brand-green) !important;
  color: #fff !important;
}
@media (prefers-color-scheme: dark) {
  :root[data-theme="auto"] .pill[aria-pressed="true"] {
    background: var(--brand-green) !important;
    border-color: var(--brand-green) !important;
    color: #fff !important;
  }
}

/* Optional: ensure the page-level variable used by .pill resolves to white in dark */
:root[data-theme="dark"] { --btn-secondary-fg: #fff !important; }
@media (prefers-color-scheme: dark) {
  :root[data-theme="auto"] { --btn-secondary-fg: #fff !important; }
}

/* 2) Theme page switch label (“Light / Dark / Auto”) should be white in dark */
:root[data-theme="dark"] .switch-label { color: #fff !important; }
@media (prefers-color-scheme: dark) {
  :root[data-theme="auto"] .switch-label { color: #fff !important; }
}

/* ===== Breadcrumb layout: last crumb pinned right, middles collapse ===== */

/* Make sure the trail is a single flex row */
.breadcrumbs { display:flex; justify-content:space-between; }
.breadcrumbs ol { 
  display:flex; align-items:center; gap:6px;
  flex:1 1 auto; min-width:0; overflow:hidden; white-space:nowrap;
}

/* Base LI behavior */
.breadcrumbs ol li { flex:0 0 auto; min-width:0; white-space:nowrap; }
.breadcrumbs ol li.sep { flex:0 0 auto; }

/* ⭐ Push the LAST separator (and therefore the final crumb that follows it)
   all the way to the right, next to Logout. */
.breadcrumbs ol li.sep:last-of-type { margin-left:auto; }

/* First crumb keeps natural width; no ellipsis */
.breadcrumbs ol li:first-child { flex:0 0 auto; }

/* Middle crumbs share remaining space and ellipsize */
.breadcrumbs ol li:not(.sep):not(:first-child):not(:last-child) { flex:1 1 0; min-width:0; }
.breadcrumbs ol li:not(.sep):not(:first-child):not(:last-child) > a,
.breadcrumbs ol li:not(.sep):not(:first-child):not(:last-child) > span {
  display:block; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
  max-width: 5ch;      /* tune (3–8ch) for how short “Pro…/Chem…” should be */
}

/* Last crumb sits at the right and is capped so it never crowds Logout */
.breadcrumbs ol li:last-child {
  flex:0 1 38%;        /* cap width; adjust 32–45% to taste */
  min-width:0;
  text-align:right;    /* optional, looks nice near Logout */
}
.breadcrumbs ol li:last-child > a,
.breadcrumbs ol li:last-child > span {
  display:block; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
}

/* Give a tiny buffer before the real Logout button in the header */
.breadcrumbs ol + .logout-btn { margin-left:10px; }
