<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#365E5A" />
  <title>Employees ‚Äî Farm Vista</title>

  <!-- Prepaint theme -->
  <script>
    (function(){
      var pref = localStorage.getItem('df_theme') || 'auto';
      var dark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      var theme = pref === 'auto' ? (dark ? 'dark' : 'light') : pref;
      document.documentElement.setAttribute('data-theme', theme);
      document.documentElement.style.colorScheme = theme === 'dark' ? 'dark' : 'light';
    })();
  </script>

  <!-- App shell (we're in /teams-partners so paths need ../) -->
  <link rel="stylesheet" href="../assets/css/theme.css" />
  <script defer src="../js/version.js"></script>
  <script defer src="../js/core.js"></script>
  <script defer src="../assets/data/menus.js"></script>

  <!-- Firebase + auth guard -->
  <script type="module" src="../js/firebase-init.js"></script>
  <script type="module" src="../js/auth-guard.js"></script>

  <style>
    h1 { margin: 0 0 10px; color: var(--fv-blue-dark); }
    .intro { color: var(--fv-muted); margin-bottom: 18px; }
    #status { display:none; margin-bottom:18px; padding:12px 16px; border-radius:var(--fv-radius-sm); border:1px solid var(--fv-border); background:var(--fv-paper-strong); font-weight:600; }
    #status.ok { border-color: rgba(47,86,62,0.45); background: rgba(47,86,62,0.12); color: #1d422d; }
    #status.err { border-color: rgba(160,0,0,0.35); background: rgba(255,80,80,0.14); color: #7b1111; }

    .actions { display:flex; flex-wrap:wrap; gap:10px; align-items:center; }
    .actions button { border-radius:var(--fv-radius-sm); border:1px solid var(--fv-border); background:var(--fv-paper); padding:10px 16px; font-weight:600; cursor:pointer; transition:background 0.18s ease, transform 0.18s ease; }
    .actions button:hover { background:rgba(54,94,90,0.12); transform:translateY(-1px); }
    .actions .danger { border-color: rgba(160,0,0,0.28); color:#7b1111; }

    label { font-weight:600; color:var(--fv-ink-soft); }
    input, select { width:100%; padding:12px 14px; border-radius:var(--fv-radius-sm); border:1px solid var(--fv-border); background:rgba(255,255,255,0.82); font: inherit; }
    select[multiple] { min-height:162px; }
    .form-grid { display:grid; gap:12px; }
    .form-row { display:grid; gap:12px; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); }
    .muted { color: var(--fv-muted); font-size:0.9rem; }

    .list { margin-top:14px; max-height:280px; overflow:auto; border:1px solid var(--fv-border); border-radius:var(--fv-radius-md); background:rgba(255,255,255,0.85); }
    .list-item { display:flex; justify-content:space-between; gap:10px; padding:12px 16px; border-bottom:1px solid var(--fv-border); cursor:pointer; transition:background 0.18s ease; }
    .list-item:hover, .list-item:focus { background:rgba(54,94,90,0.08); outline:none; }
    .list-item:last-child { border-bottom:none; }

    .perm-grid { display:grid; grid-template-columns: minmax(160px,1fr) repeat(5, minmax(70px, 90px)); align-items:center; gap:8px; }
    .perm-grid + .perm-grid { margin-top:6px; }
    .perm-grid .head { font-weight:700; color:var(--fv-ink-soft); }
    .perm-grid input[type="checkbox"] { width:auto; margin:0 auto; transform:scale(1.1); }

    .card-title { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; }
    .card-title h2 { margin:0; font-size:1.15rem; color:var(--fv-blue-dark); }

    .btn-primary { background:var(--fv-blue); color:#fff; border:none !important; }
    .btn-primary:hover { background:var(--fv-blue-dark); }
    .btn-danger { border-color: rgba(160,0,0,0.28) !important; color:#fff; background:#a00000; }
    .btn-danger:hover { background:#7b1111; }

    @media (max-width:640px) {
      .perm-grid { grid-template-columns: minmax(140px,1fr) repeat(5, 64px); font-size:0.85rem; }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="app-header">
    <div class="app-header__left">
      <img src="../assets/icons/Farm_Vista_Logo.png" alt="Farm Vista Logo" class="app-logo" />
      <div class="app-header__title">Farm Vista</div>
    </div>
    <div class="app-header__right"><span id="clock" class="clock">--:--</span></div>
  </header>

  <!-- Breadcrumbs -->
  <nav class="breadcrumbs" aria-label="Breadcrumb">
    <ol>
      <li><a href="../index.html">Home</a></li>
      <li class="sep">‚Ä∫</li>
      <li><a href="index.html">Teams &amp; Partners</a></li>
      <li class="sep">‚Ä∫</li>
      <li><span>Employees</span></li>
    </ol>
  </nav>

  <!-- Main -->
  <main class="content" data-has-form>
    <h1>üë• Employees</h1>
    <p class="intro">Create an employee (auto-ID), set email &amp; roles, then ‚ÄúSave &amp; Send Invite‚Äù. Overrides (optional) grant extra permissions per person.</p>

    <div id="status" class="status" role="status" aria-live="polite"></div>

    <section class="card">
      <div class="card-title">
        <h2>Team Members</h2>
        <span id="selHint" class="muted">(no employee selected)</span>
      </div>
      <div class="actions">
        <button id="btnAdd" class="btn-primary" type="button">+ Add Employee</button>
        <button id="btnRefresh" type="button">Refresh List</button>
      </div>
      <div id="empList" class="list" aria-label="Employees list"></div>
    </section>

    <section class="card">
      <div class="card-title">
        <h2 id="detailsHeading">Details</h2>
      </div>
      <div class="form-grid" role="group" aria-labelledby="detailsHeading">
        <div class="form-row">
          <div class="field">
            <label for="firstName">First</label>
            <input id="firstName" type="text" placeholder="First name" />
          </div>
          <div class="field">
            <label for="lastName">Last</label>
            <input id="lastName" type="text" placeholder="Last name" />
          </div>
        </div>
        <div class="field">
          <label for="email">Email</label>
          <input id="email" type="email" placeholder="email@example.com" />
        </div>
        <div class="form-row" style="align-items:flex-end;">
          <div class="field">
            <label for="roles">Roles</label>
            <select id="roles" multiple aria-label="Roles"></select>
          </div>
          <span class="muted">Hold Ctrl/‚åò to multi-select</span>
        </div>
        <div class="actions">
          <button id="btnSave" class="btn-primary" type="button">Save</button>
          <button id="btnSaveInvite" class="btn-primary" type="button">Save &amp; Send Invite</button>
          <button id="btnDelete" class="btn-danger" type="button">Delete</button>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="card-title">
        <h2>Per-Employee Permission Overrides</h2>
      </div>
      <p class="muted">Overrides grant extra permissions beyond the role(s). (Checked = allow.)</p>
      <div class="perm-grid" id="permHeader">
        <div class="head">Menu Path</div>
        <div class="head">View</div>
        <div class="head">Create</div>
        <div class="head">Edit</div>
        <div class="head">Delete</div>
        <div class="head">Archive</div>
      </div>
      <div id="permRows" style="margin-top:10px;"></div>
      <div class="actions" style="margin-top:14px;">
        <button id="btnSaveOverrides" class="btn-primary" type="button">Save Overrides</button>
        <button id="btnClearOverrides" class="danger" type="button">Clear All Overrides</button>
      </div>
    </section>
  </main>

  <!-- Page logic -->
  <script type="module" src="../js/employees-admin.js"></script>
</body>
</html>
