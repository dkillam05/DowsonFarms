<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="format-detection" content="telephone=no" />
  <title>Sign in — Dowson Farms</title>

  <!-- Apply saved theme (before CSS paints) -->
  <script>
    (function () {
      try {
        var pref = localStorage.getItem('df_theme') || 'auto';
        document.documentElement.setAttribute('data-theme', pref);
      } catch (e) {
        document.documentElement.setAttribute('data-theme', 'auto');
      }
    })();
  </script>

  <!-- Theme + core -->
  <link rel="stylesheet" href="../assets/css/theme.css" />
  <script defer src="../js/version.js"></script>
  <script defer src="../js/core.js"></script>

  <!-- PWA / iOS -->
  <link rel="manifest" href="../manifest.webmanifest" />
  <meta name="theme-color" content="#1B5E20" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="apple-touch-icon" href="../assets/icons/icon-192.png" />

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&display=swap" rel="stylesheet" />
</head>
<body class="auth-page">

  <main class="auth-wrap">
    <!-- Brand on background -->
    <div class="auth-hero">
      <div class="auth-hero__logo">
        <img src="../assets/icons/icon-192.png" alt="Dowson Farms" />
      </div>
      <h1 class="auth-hero__title">Dowson Farms</h1>
      <p class="auth-hero__subtitle">Welcome back. Sign in to continue.</p>
    </div>

    <!-- Login card -->
    <div class="auth-card auth-card--compact">
      <form id="loginForm" class="auth-form" novalidate>
        <div class="field">
          <label for="username">Email</label>
          <input
            id="username"
            name="username"
            type="email"
            inputmode="email"
            autocomplete="username"
            placeholder="you@example.com"
            required
          />
          <p class="field-hint" id="usernameHint" hidden>Please enter a valid email.</p>
        </div>

        <div class="field">
          <label for="password">Password</label>
          <div class="password-wrap">
            <input
              id="password"
              name="password"
              type="password"
              autocomplete="current-password"
              placeholder="Password"
              required
              minlength="6"
            />
            <button type="button" class="eye" aria-label="Show password" aria-pressed="false" id="togglePw"></button>
          </div>
          <p class="field-hint" id="passwordHint" hidden>Password must be at least 6 characters.</p>
        </div>

        <div class="form-row">
          <label class="checkbox">
            <input type="checkbox" id="remember" name="remember" />
            <span>Remember me</span>
          </label>
          <a class="muted-link" href="#" id="forgotLink">Forgot password?</a>
        </div>

        <button type="submit" class="btn-primary">Log In</button>
      </form>
    </div>
  </main>

  <!-- Footer -->
  <footer class="app-footer app-footer--auth">
    <span id="report-date">—</span>
    <span class="dot">•</span>
    <span id="version">v0.0.0</span>
  </footer>

  <!-- Forgot password modal -->
  <div class="auth-modal__backdrop" id="fpModal" role="dialog" aria-modal="true" aria-labelledby="fpTitle" style="display:none;">
    <div class="auth-modal">
      <h2 id="fpTitle">Reset your password</h2>
      <p>Enter your email. If it matches an account, you’ll get a reset link.</p>
      <div class="field">
        <label for="fpEmail">Email</label>
        <input id="fpEmail" type="email" inputmode="email" placeholder="you@example.com" />
        <p class="field-hint" id="fpHint" hidden>Please enter a valid email address.</p>
        <p class="field-hint" id="fpError" hidden style="color:#b00020"></p>
        <p class="field-hint" id="fpSuccess" hidden style="color:#0a7a28">If the email exists, a reset link has been sent.</p>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-link" id="fpCancel">Cancel</button>
        <button type="button" class="btn-secondary" id="fpSend">Send reset link</button>
      </div>
    </div>
  </div>

  <!-- Page scripts -->
  <script>
    // Toggle password visibility
    (function(){
      const input = document.getElementById('password');
      const btn = document.getElementById('togglePw');
      if (!input || !btn) return;

      const ICON_EYE = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12Z"/><circle cx="12" cy="12" r="3.5"/></svg>';
      const ICON_EYE_OFF = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3l18 18M10.6 10.6A3.5 3.5 0 0115 12m6-0c0 0-4 7-11 7-2.1 0-3.9-.6-5.4-1.5M4.3 7.7C6.2 6 8.8 5 12 5c7 0 11 7 11 7"/></svg>';

      let showing = false;
      function render(){ btn.innerHTML = showing ? ICON_EYE_OFF : ICON_EYE; }
      render();

      btn.addEventListener('click', () => {
        showing = !showing;
        input.type = showing ? 'text' : 'password';
        render();
      });
    })();

    // Login form demo redirect
    document.getElementById('loginForm')?.addEventListener('submit', (e) => {
      e.preventDefault();
      const email = document.getElementById('username');
      const pass  = document.getElementById('password');
      const emailOK = /\S+@\S+\.\S+/.test(email.value);
      const passOK  = pass.value && pass.value.length >= 6;

      document.getElementById('usernameHint').hidden = emailOK;
      document.getElementById('passwordHint').hidden = passOK;

      if (!emailOK || !passOK) return;

      // TODO: real auth
      window.location.replace("../index.html");
    });

    // Forgot password modal
    (function(){
      const openBtn = document.getElementById('forgotLink');
      const modal = document.getElementById('fpModal');
      const cancelBtn = document.getElementById('fpCancel');
      const emailIn = document.getElementById('fpEmail');

      openBtn?.addEventListener('click', (e)=>{ e.preventDefault(); modal.style.display='flex'; emailIn.focus(); });
      cancelBtn?.addEventListener('click', ()=>{ modal.style.display='none'; });
      modal?.addEventListener('click', (e)=>{ if (e.target===modal) modal.style.display='none'; });
    })();
  </script>

  <!-- Service worker (auth folder is one level deep) -->
  <script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("../js/serviceworker.js", { scope: "../" })
        .catch(console.error);
    });
  }
  </script>
</body>
</html>