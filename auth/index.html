<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Sign in — Dowson Farms</title>

  <!-- Theme -->
  <link rel="stylesheet" href="../assets/css/theme.css" />
  <script defer src="../js/version.js"></script>
  <script defer src="../js/firebase-init.js"></script>
  <script defer src="../js/core.js"></script>
</head>
<body class="auth-page">
  <main class="auth-wrap">
    <div class="auth-hero">
      <img src="../assets/icons/icon-192.png" alt="Dowson Farms" />
      <h1>Dowson Farms</h1>
      <p>Welcome back. Sign in to continue.</p>
    </div>

    <div class="auth-card auth-card--compact">
      <form id="loginForm" class="auth-form" novalidate>
        <div class="field">
          <label for="username">Email</label>
          <input id="username" type="email" required placeholder="you@example.com" />
        </div>

        <div class="field">
          <label for="password">Password</label>
          <input id="password" type="password" required minlength="6" placeholder="Password" />
        </div>

        <div class="form-row">
          <label><input type="checkbox" id="remember" /> Remember me</label>
          <a href="#" id="forgotLink">Forgot password?</a>
        </div>

        <button type="submit" class="btn-primary">Log In</button>
        <p id="loginError" hidden style="color:#b00020; margin-top:8px;"></p>
      </form>
    </div>
  </main>

  <footer class="app-footer app-footer--auth">
    <span id="report-date">—</span>
    <span class="dot">•</span>
    <span id="version">v0.0.0</span>
  </footer>

  <script type="module">
    const form   = document.getElementById('loginForm');
    const email  = document.getElementById('username');
    const pass   = document.getElementById('password');
    const errEl  = document.getElementById('loginError');
    const remember = document.getElementById('remember');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      errEl.hidden = true;

      try {
        await window.DF_FB_API.init();
        await window.DF_FB_API.setPersistence(remember.checked);
        await window.DF_FB_API.signInEmail(email.value, pass.value);
        location.href = '../index.html'; // success
      } catch (err) {
        console.error(err);
        errEl.textContent = "Login failed: " + (err.code || err.message);
        errEl.hidden = false;
      }
    });
  </script>
</body>
</html>