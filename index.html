<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0f5a1a" />
  <title>Dowson Farms — Home</title>

  <!-- GitHub Pages base -->
  <base href="/DowsonFarms/">

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="apple-touch-icon" sizes="180x180" href="assets/icons/icon-192.png" />
  <link rel="apple-touch-icon" sizes="512x512" href="assets/icons/maskable-512.png" />

  <!-- Prepaint theme -->
  <script>
    (function () {
      var pref = localStorage.getItem('df_theme') || 'auto';
      var dark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      var mode = pref === 'auto' ? (dark ? 'dark' : 'light') : pref;
      document.documentElement.setAttribute('data-theme', mode);
      document.documentElement.style.colorScheme = mode === 'dark' ? 'dark' : 'light';
    })();
  </script>

  <!-- Drawer CSS (existing) -->
  <link rel="stylesheet" href="assets/css/drawer.css" />

  <!-- Page chrome kept inline so theme.css can stay empty -->
  <style>
    :root { --df-green:#0f5a1a; --df-ink:#fff; --hdr-h:56px; }

    /* Fixed header (matches footer/nav color) */
    .app-header{
      position:fixed; top:0; left:0; right:0; z-index:1000;
      height:var(--hdr-h);
      background:var(--df-green);
      display:flex; align-items:center; gap:10px;
      padding:0 12px;
      color:var(--df-ink);
    }
    body{ margin:0; padding-top:var(--hdr-h); }

    .burger{
      appearance:none; -webkit-appearance:none;
      background:transparent; border:0;
      color:var(--df-ink); font-size:24px; line-height:1; cursor:pointer;
    }
    .app-logo{ width:30px; height:30px; border-radius:8px; }
    .app-title{ font-weight:700; font-size:18px; }
    .spacer{ flex:1; }
    .clock{ font-variant-numeric:tabular-nums; }

    main{ padding:18px; max-width:1100px; margin:0 auto; }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="app-header">
    <button id="drawerToggle" class="burger" aria-label="Open menu">☰</button>
    <img class="app-logo" src="assets/icons/icon-192.png" alt="">
    <div class="app-title">Dowson Farms</div>
    <div class="spacer"></div>
    <span id="clock" class="clock">--:--</span>
  </header>

  <!-- Drawer shell (built by js/drawer.js) -->
  <div id="drawer" class="drawer" aria-label="Side menu">
    <div class="brand">
      <img src="assets/icons/icon-192.png" alt="">
      <div>
        <div style="font-weight:700">Dowson Farms</div>
        <div class="mono" id="farmSub">All systems operational</div>
      </div>
    </div>
    <nav></nav>
  </div>
  <div id="drawerBackdrop" class="drawerBackdrop"></div>

  <!-- Main -->
  <main>
    <h1>Welcome</h1>
    <p>This Home screen will grow (Chat-style box, weather, quick cards). Use the ☰ menu for navigation.</p>
  </main>

  <!-- Data sources -->
  <script src="assets/data/menus.js"></script>
  <script src="assets/data/drawer-menus.js"></script>
  <script src="assets/data/footer-links.js"></script>

  <!-- Version (single source, used by drawer footer) -->
  <script defer src="js/version.js"></script>

  <!-- Firebase + your guard (guard also injects the global wait overlay) -->
  <script type="module" src="js/firebase-init.js"></script>
  <script type="module" src="js/auth-guard.js"></script>

  <!-- Drawer + Footer builders -->
  <script type="module" src="js/drawer.js"></script>
  <script src="js/footer.js"></script>

  <!-- Clock + PWA registration -->
  <script>
    // header clock
    (function tick(){
      var el = document.getElementById('clock');
      function render(){ var d=new Date(); el.textContent = d.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'}); }
      render(); setInterval(render, 1000);
    })();

    // Register your existing ServiceWorker.js (case-sensitive on GitHub Pages)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function () {
        navigator.serviceWorker.register('/DowsonFarms/ServiceWorker.js', { scope: '/DowsonFarms/' })
          .catch(console.warn);
      });
    }
  </script>
</body>
</html>