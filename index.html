<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Dowson Farms</title>
  <base href="./"/>
  <link rel="icon" sizes="192x192" href="assets/icons/icon-192.png">
  <link rel="apple-touch-icon" href="assets/icons/apple-touch-icon.png">
  <link rel="stylesheet" href="assets/css/theme.css"/>
</head>
<body>

  <!-- Header (minimal) -->
  <header class="app-header">
    <div class="title">Dowson Farms</div>
    <div class="spacer">
      <span id="df-date"></span><span id="df-clock"></span>
    </div>
  </header>

  <!-- Breadcrumbs with hamburger + logout -->
  <nav class="breadcrumbs">
    <button id="hamburger" class="hamburger" aria-label="Open menu">☰</button>
    <ol id="crumbs">
      <li><span>Home</span></li>
    </ol>
    <button class="logout-btn" id="logout">Logout</button>
  </nav>

  <!-- Drawer + backdrop -->
  <aside id="drawer" class="drawer" aria-label="Navigation">
    <div class="drawer-hd">Menu</div>
    <ul id="nav" class="nav"></ul>
  </aside>
  <div id="backdrop" class="backdrop"></div>

  <!-- Content -->
  <main class="content">
    <h1>Search your operation</h1>
    <p class="subtle">Ask for anything: “planting records for North Field in 2023”, “maintenance on S780”, “Jake’s hours last week”…</p>

    <div class="card">
      <div class="searchbar">
        <input id="global-search" type="text" placeholder="Search or ask a question…" autocomplete="off">
        <button class="icon-btn" title="Voice (placeholder)">🎤</button>
      </div>
    </div>

    <section class="card">
      <h2>Recent activity</h2>
      <div class="row" id="recent"></div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="app-footer">
    <span id="version">v0.0.0</span>
    <span>•</span>
    <span id="status">Connected</span>
  </footer>

  <!-- Data + core -->
  <script src="assets/data/menus.js"></script>
  <script src="js/core.js"></script>

  <!-- Page wiring: drawer, breadcrumbs, simple recents -->
  <script>
  (function(){
    'use strict';

    // clock/date already installed by core.js (kept ids df-date / df-clock)

    // logout using core's handler
    document.getElementById('logout').addEventListener('click', function(e){
      e.preventDefault();
      (window.handleLogout || window.DF_UI?.logout || window.handleLogoutFallback || function(){}) (e);
    }, { once:false });

    const drawer = document.getElementById('drawer');
    const backdrop = document.getElementById('backdrop');
    const btn = document.getElementById('hamburger');
    const nav = document.getElementById('nav');
    const menus = (window.DF_MENUS && Array.isArray(window.DF_MENUS.tiles)) ? window.DF_MENUS.tiles : [];

    function open(){ drawer.classList.add('open'); backdrop.classList.add('show'); }
    function close(){ drawer.classList.remove('open'); backdrop.classList.remove('show'); }
    btn.addEventListener('click', open);
    backdrop.addEventListener('click', close);

    // Build drawer from your menus (real data)
    nav.innerHTML='';
    menus.forEach(sec=>{
      const li=document.createElement('li');
      const b=document.createElement('button');
      b.className='section-btn'; b.setAttribute('aria-expanded','false');
      b.innerHTML=`<span class="section-ico">${sec.iconEmoji||'📁'}</span><span>${sec.label||''}</span><span class="chev">›</span>`;
      const sub=document.createElement('div'); sub.className='sub';
      (sec.children||[]).forEach(ch=>{
        const a=document.createElement('a'); a.href=ch.href||'#'; a.textContent=`${ch.iconEmoji||''} ${ch.label||''}`;
        sub.appendChild(a);
      });
      b.addEventListener('click', (e)=>{
        if (e.target.classList.contains('chev')) {
          const open=sub.classList.toggle('open');
          b.setAttribute('aria-expanded', open ? 'true' : 'false');
        } else {
          if (sec.href) location.href = sec.href;
        }
      });
      li.appendChild(b); if ((sec.children||[]).length) li.appendChild(sub);
      nav.appendChild(li);
    });

    // Breadcrumbs for Home
    const crumbs=document.getElementById('crumbs');
    crumbs.innerHTML='<li><span>Home</span></li>';

    // Fake recent activity (replace later)
    const recent=document.getElementById('recent');
    const sample=[
      {label:'Added equipment “S780”', href:'equipment/equipment-combines.html'},
      {label:'Imported planting logs (Apr 2024)', href:'crop-production/crop-planting.html'},
      {label:'Generated AI report', href:'reports/reports-ai.html'}
    ];
    sample.forEach(i=>{
      const a=document.createElement('a'); a.href=i.href; a.className='btn'; a.textContent=i.label; recent.appendChild(a);
    });
  })();
  </script>
</body>
</html>